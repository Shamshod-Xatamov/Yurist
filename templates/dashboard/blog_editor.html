{% extends 'base.html' %}
{% load static %}

{% block content %}
{{ form.media }}
<style>
    /* Kategoriya maydonini (Select) majburiy ko'rinadigan qilish */
    #id_category {
        display: block !important;
        width: 100% !important;
        height: 3.5rem !important; /* balandligi h-14 */
        padding: 0.75rem 1rem !important;

        /* Chegarani aniq ko'rsatish */
        border: 1px solid #d1d5db !important;
        background-color: #ffffff !important;
        border-radius: 0.375rem !important;

        /* Matn rangi */
        color: #111827 !important;
        font-size: 1rem !important;

        /* Strelka (Dropdown arrow) */
        appearance: none !important;
        -webkit-appearance: none !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") !important;
        background-position: right 0.75rem center !important;
        background-repeat: no-repeat !important;
        background-size: 1.5em 1.5em !important;
    }

    /* Barcha inputlar uchun umumiy stil (bir xil turishi uchun) */
    input[type="text"],
    input[type="number"],
    textarea,
    .django-ckeditor-widget {
        border: 1px solid #d1d5db !important;
        border-radius: 0.375rem !important;
    }

    /* Bosilganda (Focus) sariq bo'lishi */
    #id_category:focus,
    input:focus,
    textarea:focus {
        border-color: #ca8a04 !important;
        outline: 2px solid #ca8a04 !important;
        outline-offset: -1px;
    }
</style>

<!-- Lucide Icons Script -->
<script src="https://unpkg.com/lucide@latest"></script>

<section class="py-24 lg:py-32 bg-white min-h-screen">

    <div class="w-full max-w-[1280px] mx-auto px-6 lg:px-12">
        <div class="max-w-4xl mx-auto">
        <div class="mb-8">
    <a href="{% url 'dashboard_home' %}"
       class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:text-gray-900 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
        <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
        Dashboardga qaytish
    </a>
</div>
            <!-- HEADER -->
            <div class="mb-12">
                <h1 class="text-4xl lg:text-5xl text-gray-900 mb-2 font-serif font-medium">
                    {% if form.instance.pk %}Maqolani tahrirlash{% else %}Yangi maqola yaratish{% endif %}
                </h1>

                <p class="text-gray-500 text-lg">
                    {% if form.instance.pk %}Mavjud blog postini o'zgartirish{% else %}Yangi huquqiy maqola yozing va nashr eting{% endif %}
                </p>
            </div>


            <!-- EDITOR FORM -->
            <!-- enctype="multipart/form-data" rasm yuklash uchun shart -->
            <form method="POST" enctype="multipart/form-data" class="space-y-8">
                {% csrf_token %}

                <!-- TITLE INPUT -->
                <div class="space-y-2">
                    <label for="id_title" class="block text-gray-900 font-medium">
                        Maqola Sarlavhasi *
                    </label>
                    <input
                        type="text"
                        name="title"
                        id="id_title"
                        value="{{ form.title.value|default:'' }}"
                        placeholder="Jozibali sarlavha kiriting..."
                        required
                        class="w-full h-14 px-4 text-lg rounded-md border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:border-transparent transition-colors placeholder:text-gray-400"
                    >
                    {% if form.title.errors %}
                        <p class="text-red-500 text-sm">{{ form.title.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- EXCERPT TEXTAREA -->
                <div class="space-y-2">
                    <label for="id_excerpt" class="block text-gray-900 font-medium">
                        Qisqa tavsif (Excerpt) *
                    </label>
                    <textarea
                        name="excerpt"
                        id="id_excerpt"
                        rows="3"
                        placeholder="Blog ro'yxatida ko'rinadigan qisqa mazmun..."
                        required
                        class="w-full p-4 rounded-md border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:border-transparent transition-colors resize-none placeholder:text-gray-400"
                    >{{ form.excerpt.value|default:'' }}</textarea>
                </div>
                <div class="space-y-2">
                    <label for="id_content" class="block text-gray-900 font-medium">
                        Maqola Matni *
                    </label>

                    <!-- Agar CKEditor ishlatayotgan bo'lsangiz, bu yerda widget avtomatik chiqadi -->
                    <div class="prose-editor">
                        {{ form.content }}
                    </div>

                    <p class="text-sm text-gray-500">
                        Maslahat: Sarlavhalar va formatlashdan foydalaning.
                    </p>
                </div>

                <!-- GRID: CATEGORY & READ TIME -->
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Category -->
                    <div class="space-y-2">
                        <label for="id_category" class="block text-gray-900 font-medium">
                            Kategoriya *
                        </label>
                        <!-- Select styling -->
                        <div class="relative">
                            {{ form.category }}
                            <!-- Djangoning o'zini selecti render bo'ladi, lekin biz CSS bilan unga stil berishimiz kerak.
                                 Forms.py da widget attr bergan ma'qul, yoki bu yerda custom select yasash kerak.
                                 Oddiylik uchun form.category ni chiqaramiz va pastda CSS bilan to'g'irlaymiz -->
                        </div>
                    </div>

                    <!-- Read Time -->
                    <div class="space-y-2">
                        <label for="id_read_time" class="block text-gray-900 font-medium">
                            O'qish vaqti (daqiqa) *
                        </label>
                        <input
                            type="number"
                            name="read_time"
                            id="id_read_time"
                            min="1"
                            value="{{ form.read_time.value|default:'5' }}"
                            required
                            class="w-full h-12 px-4 rounded-md border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:border-transparent transition-colors"
                        >
                    </div>

                </div>

                <!-- TAGS INPUT -->
                <div class="space-y-2">
                    <label for="id_tags" class="block text-gray-900 font-medium">
                        Taglar (vergul bilan ajrating)
                    </label>
                    <input
                        type="text"
                        name="tags"
                        id="id_tags"
                        value="{{ form.tags.value|default:'' }}"
                        placeholder="Masalan: Korporativ huquq, Biznes, Sud"
                        class="w-full h-12 px-4 rounded-md border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:border-transparent transition-colors placeholder:text-gray-400"
                    >
                    <p class="text-sm text-gray-500">
                        Taglarni vergul bilan ajrating. Bu o'quvchilarga o'xshash mavzularni topishga yordam beradi.
                    </p>
                </div>

                <!-- IMAGE INPUT (Reactdagi URL o'rniga File Upload) -->
                <div class="space-y-2">
                    <div class="mb-6">
    <label for="image_input" class="block text-sm font-medium text-gray-700 mb-2">
        Rasmni o'zgartirish
    </label>
    <!-- name="image" bo'lishi SHART (Modeldagi nom bilan bir xil) -->
    <input type="file"
           name="image"
           id="image_input"
           accept="image/*"
           class="block w-full text-sm text-gray-500
            file:mr-4 file:py-2 file:px-4
            file:rounded-md file:border-0
            file:text-sm file:font-semibold
            file:bg-blue-50 file:text-blue-700
            hover:file:bg-blue-100">
</div>

                    <!-- Image Preview (Agar rasm yuklangan bo'lsa) -->
                    {% if form.instance.image %}
                    <div class="mt-4 rounded-md overflow-hidden border border-gray-200 shadow-sm w-full h-64">
                        <img src="{{ form.instance.image.url }}" alt="Preview" class="w-full h-full object-cover">
                        <p class="text-xs text-gray-500 mt-1 p-2">Hozirgi rasm: {{ form.instance.image.name }}</p>
                    </div>
                    {% endif %}
                </div>

                <!-- CONTENT (CKEDITOR yoki Textarea) -->


                <!-- ACTION BUTTONS -->
                <div class="flex items-center gap-4 pt-6 border-t border-gray-200">
                    <button
                        type="submit"
                        class="inline-flex items-center justify-center h-12 px-6 rounded-md bg-yellow-600 text-white font-medium hover:bg-yellow-700 transition-colors shadow-sm"
                    >
                        <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                        {% if form.instance.pk %}Yangilash{% else %}Nashr qilish{% endif %}
                    </button>

                    <a href="{% url 'dashboard_home' %}"
                       class="inline-flex items-center justify-center h-12 px-6 rounded-md border border-gray-300 bg-white text-gray-700 font-medium hover:bg-gray-50 transition-colors"
                    >
                        <i data-lucide="x" class="w-5 h-5 mr-2"></i>
                        Bekor qilish
                    </a>
                </div>

            </form>
        </div>
    </div>
</section>

<!-- Additional CSS for Form Elements to match React design -->
<style>
    select {
        appearance: none; /* Standart xunuk dizaynni o'chirish */
        -webkit-appearance: none;
        -moz-appearance: none;

        display: block;
        width: 100%;
        height: 3.5rem; /* h-14 */
        padding: 0.75rem 1rem;
        padding-right: 2.5rem; /* Strelka uchun joy */

        font-size: 1rem;
        line-height: 1.5;
        color: #111827; /* To'q qora matn */
        background-color: #ffffff;
        border: 1px solid #d1d5db; /* border-gray-300 */
        border-radius: 0.375rem; /* rounded-md */

        /* MUHIM: STRELKA IKONKASI (SVG) */
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.75rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;

        transition: all 0.2s ease-in-out;
    }

    /* Focus bo'lganda (bosilganda) sariq bo'lishi */
    select:focus {
        border-color: #ca8a04; /* yellow-600 */
        outline: none;
        box-shadow: 0 0 0 2px rgba(202, 138, 4, 0.2);
    }

    /* Inputlar uchun ham bir xil stil (agar oldin bo'lmasa) */
    input[type="text"],
    input[type="number"],
    textarea {
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        width: 100%;
    }
    input:focus, textarea:focus {
        border-color: #ca8a04;
        outline: none;
        box-shadow: 0 0 0 2px rgba(202, 138, 4, 0.2);
    }
</style>


<script>
    lucide.createIcons();
</script>

{% endblock %}